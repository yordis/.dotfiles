#- name: get openssl path
#  command: "brew --prefix openssl"
#  register: openssl_path

- name: clone asdf repository
  git:
    repo: https://github.com/asdf-vm/asdf.git
    dest: "{{ user_home_directory }}/.asdf"
    version: master
    depth: "1"

- name: symlink .asdfrc file
  file:
    src: "{{ dotfiles_directory }}/roles/asdf/files/asdfrc.symlink"
    dest: "{{ user_home_directory }}/.asdfrc"
    state: link
    force: yes

- name: add plugins
  loop: "{{ plugins }}"
  command:
    cmd: "{{ user_home_directory }}/.asdf/bin/asdf plugin-add {{ item.name }} {{ item.url }}"
    creates: "{{ user_home_directory }}/.asdf/plugins/{{ item.name }}/bin/install"
  register: plugin_add
  failed_when: plugin_add == 2

- name: install versions
  loop: "{{ versions }}"
  command:
    cmd: "{{ user_home_directory }}/.asdf/bin/asdf install {{ item.name }} {{ item.version }}"
    creates: "{{ user_home_directory }}/.asdf/installs/{{ item.name }}/{{ item.version }}"
  environment: "{{ item.environment }}"

- name: set global version
  loop: "{{ global_versions }}"
  command: "{{ user_home_directory }}/.asdf/bin/asdf global {{ item.name }} {{ item.version }}"
